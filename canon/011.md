\title{
Organizing Physics with Open Energy-Driven Systems
}

\author{
Matteo Capucci \\ University of Strathclyde \\ matteo.capucci@gmail.com
}

\author{
Owen Lynch \\ Topos Institute \\ owen@topos.institute
}

\author{
David I. Spivak* \\ Topos Institute \\ david@topos.institute
}

\begin{abstract}
Organizing physics has been a long-standing preoccupation of applied category theory, going back at least to Lawvere. We contribute to this research thread by noticing that Hamiltonian mechanics and gradient descent depend crucially on a consistent choice of transformation-which we call a reaction structure-from the cotangent bundle to the tangent bundle. We then construct a compositional theory of reaction structures. Reaction-based systems offer a different perspective on composition in physics than port-Hamiltonian systems or open classical mechanics, in that reaction-based composition does not create any new constraints that must be solved for algebraically.

The technical contributions of this paper are the development of symmetric monoidal categories of open energy-driven systems and open differential equations, and a functor between them, functioning as a "functorial semantics" for reaction structures. This approach echoes what has previously been done for open games and open gradient-based learners, and in fact subsumes the latter. We then illustrate our theory by constructing an $n$-fold pendulum as a composite of $n$-many pendula.
\end{abstract}

\section*{1 Introduction}

A long-standing goal of applied category theory is to provide compositional frameworks for physical systems [Law80]. In this paper, we introduce a compositional framework for a generalization of both systems based on Hamiltonian mechanics and general systems which perform gradient descent. In this framework, systems interact by sending each other gradients. These gradients are converted to motion (that is, tangent vectors) by what we call a reaction. In Hamiltonian dynamics, the reaction arises from the symplectic structure and in gradient descent, the reaction arises from a Riemannian structure.

In Section 2 we explain the basic intuition: at the core, Hamiltonian dynamics and gradient descent on a manifold $X$ both depend on a map $R: T^{*} X \rightarrow T X$, which translates gradients into motion. One can imagine this as a functional version of argmax, in that given a "valuation" function $\varphi: T_{x} X \rightarrow \mathbb{R}$, one obtains a choice of element $R(\varphi) \in T_{x} X$. But whereas gradient descent really does choose a tangent direction that maximizes change along the gradient, Hamiltonian dynamics does almost the opposite, choosing a tangent direction with zero change along the gradient.

Our compositional framework is bidirectional but oriented. This means that some parts of an open system are deemed inputs whereas other parts are deemed outputs. For example, in a pendulum, the input is the position and momentum of the pivot point, and the output is the position and momentum of the bob, which another system may take as input. However, the system receives gradients on its output, and sends gradients to its input. This can be pictured in the following way.

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-01.jpg?height=152&width=697&top_left_y=2155&top_left_x=714)
\footnotetext{
*Spivak and Lynch's contribution was supported by the Air Force Office of Scientific Research under award number FA9550-23-1-0376.
}

We begin in Section 2 by reviewing Hamiltonian and gradient descent systems and their commonalities, motivating the ensuing developments. Then we define symmetric monoidal category of open energy-driven systems in Section 3) there the bidirectionality is not explicit, but instead there is an explicit choice of reaction $R$. In Section 4 we define a functor that assigns these systems a bidirectional semantics in terms of parametric lenses. We do so in two steps, the first of which is more likely generalizable and the second of which is conceptually simpler. These semantics land in lens categories, which are now well-known in categorical machine learning literature. In fact our semantics in inspired by [FST19, $\mathrm{CGG}^{+}$22], which we extend to general smooth manifolds.

Finally, Section 5 we give examples of these ideas, including a $n$-fold pendulum constructed by composing single pendula.

\subsection*{1.1 Related work}

This framework is connected to a variety of other attempts to formalize physical systems within applied category theory.
- The title of this paper is a pun based on the double category $\mathbb{O} \mathbf{r g}$ that was first developed by the third-named author in [Spi22, SS23]. One way of thinking about this paper is that it develops a "continuous version of $\mathbb{\mathbb { O } \mathbf { r g }}$."
- Another approach to "systems exerting force on each other" is port-Hamiltonian systems, which has been developed categorically by the second-named author in [Lyn22], [LLL24]. However, the doctrine of composition developed for port-Hamiltonian systems is undirected and relational, and so a computer implementation of this composition would require solving differential-algebraic equations in a similar way to $\left[\mathrm{MGA}^{+} 21\right]$ rather than just differential equations. In contrast, the framework in the current paper gives an "input-output" view on physical systems, and thus composition does not introduce new constraints that must be solved for. In future work, we hope to give an account of the relationship between the directed and undirected accounts of composition.
- Classical mechanics has been previously treated from a category theoretic viewpoint via spans of symplectic manifolds [BWY21]. However, like port-Hamiltonian systems, this approach is essentially relational, necessitating semantics in differential-algebraic equations.
- We heavily rely on the Para construction and its functoriality, as well as using roughly the same techniques of [CGHR22] for constructing our symmetric monoidal categories of open systems.
- The pattern of having a simple description of feedback systems that then gets compiled down to parametric lenses of some sort follows what [Cap23] has shown for open games. The analogy with gradient-based systems, formulated in terms of changes and valuations, already in appears in ibid.
- Resource sharing machines are another method of composing dynamical systems which has been applied to dynamical systems for physics [LBPF22]. In contrast with the present approach, resource sharing machines do not derive their dynamics from potentials and forces; rather a resource sharing machine takes the vector field as primitive. However, we hope that in the future "resource-sharing composition" will be available to use with the formalism of this paper.

\subsection*{1.2 Notational conventions}

For composition, we use 9 , to denote diagrammatic order.

For a bundle $\pi: E \rightarrow B$, we denote the set of global sections by $\Gamma(\pi):=\left\{s: B \rightarrow E \mid s_{9} \pi=1\right\}$. Given another bundle $\pi^{\prime}: E^{\prime} \rightarrow B$, we denote the bundle (over $B$ ) of fiberwise maps between them by $\left[\pi, \pi^{\prime}\right]$.

We denote by $\left(\mathbf{M f d}, \mathbb{R}^{0}, \times\right)$ the cartesian monoidal category of smooth manifolds and smooth maps between them, although everything we're saying works in well-behaved generalizations, such as diffeological spaces [Sou06]. We denote the circle by $S^{1} \in \mathbf{M f d}$. The wide subcategory of smooth manifolds and isomorphisms between them is denoted Mfd ${ }^{\text {iso }}$; from which it inherits the (no longer cartesian) monoidal structure $\left(\mathbb{R}^{0}, \times\right)$.

\subsection*{1.3 Prerequisites}

In order for the framework of this paper to be comprehensible, a certain amount of context must be given, but also a certain amount of context must be omitted for brevity.

The context that we omit and we assume the reader to be already acquainted with is basic differential geometry (definition and functoriality of tangent and cotangent bundles), and especially the theory of vector bundles (we reference [KMS93]). We also expect the reader to be familiar with the Para construction (see [FST19, CGHR22, $\mathrm{CGG}^{+} 22$ ]) and its functorial properties, but we nonetheless spell out the result when we invoke it.

It will also be help the reader to be familiar with Hamiltonian mechanics and gradient descent, but we will briefly review these so that a sufficiently determined reader may get through this paper without too much prior experience.

Lastly, while we kept this work strictly in the land of 1-categories for brevity, we use ideas from categorical systems theory and think of our constructions as shadows of their essentially double-categorical nature. So being aware of [Mye23a] is not required (except in passages where we explictly draw a connection) but might help understanding the subtext.

\section*{2 Intuition}

Hamiltonian mechanics and gradient descent have a common mathematical structure. We start by reviewing them.

\subsection*{2.1 Hamiltonian mechanics}

A Hamiltonian system consists of a state space $X \in$ Mfd with a full-rank symplectic form $\omega \in \Gamma\left(T^{*} X \wedge\right.$ $\left.T^{*} X\right)$ and a function $H: X \rightarrow \mathbb{R}$, called the Hamiltonian, which represents the system's energy at any $x \in X$. Applying $\omega$ and the sequence of maps

$$
T^{*} X \wedge T^{*} X \rightarrow T^{*} X \otimes T^{*} X \cong\left[T X, T^{*} X\right]
$$

we produce a section $K_{\omega} \in \Gamma\left[T X, T^{*} X\right]$, i.e. a linear map $T X \rightarrow T^{*} X$ over $X$, which is invertible because $\omega$ is full-rank. Call its inverse $J_{\omega} \in \Gamma\left[T^{*} X, T X\right]$; we refer to it as the reaction associated to $\omega$. Then the dynamics of the system $(X, \omega, H)$ are given by Hamilton's equation, i.e. the differential equation

$$
\frac{\mathrm{d} x}{\mathrm{~d} t}=J_{\omega}(x) \mathrm{d} H(x)
$$

Note that the dynamics only depend on the reaction $J_{\omega}$ rather than $\omega$; we started with the symplectic form to connect to the more conventional way of doing things, but we will almost exclusively only work with reactions in the future.

Remark 1. Notice how the assumptions on $\omega$ (non-degeneracy and antisymmetry) are not necessary for $J$ to be well-defined. In fact we get a reaction also from a Poisson structure [CFM21], this being simply a symplectic structure for which the non-degeneracy axiom is relaxed. Practically, these can be used to model dissipative Hamiltonian systems.

For any smooth manifold $M \in$ Mfd of dimension $n$, there is a canonical symplectic structure on its cotangent space $X:=T^{*} M$. Given a coordinate chart for $M$ and the induced coordinate chart on $T^{*} M$ and $T M$, the corresponding reaction $J: T_{x}^{*} X \rightarrow T_{x} X$ over $x \in X$ has the following form

$$
J(x)=\left[\begin{array}{cc}
0 & I_{n} \\
-I_{n} & 0
\end{array}\right]
$$

where $I_{n}$ is the $(n \times n)$-identity matrix. Note that $J(x)$ is independent of the choice of coordinate chart [Arn13, Chapter 8].

Example 2. Consider the pendulum of fixed length $l$ and mass $m$ shown here

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-04.jpg?height=317&width=315&top_left_y=926&top_left_x=905)

The little dot is called the pivot and the big dot is called the bob. We can model this as a Hamiltonian system by letting $X=T^{*} S^{1}$ with coordinates $(\theta, L)$ representing angle and angular momentum. Then (2) becomes

$$
J(x)=\left[\begin{array}{cc}
0 & -1 \\
1 & 0
\end{array}\right]
$$

because $S^{1}$ is 1-dimensional. For a given map $H: T^{*} S^{1} \rightarrow \mathbb{R}$, Eq. (1) reads

$$
\frac{\mathrm{d} \theta}{\mathrm{d} t}=\frac{\partial H}{\partial L}, \quad \frac{\mathrm{d} L}{\mathrm{~d} t}=-\frac{\partial H}{\partial \theta}
$$

To model a pendulum as in (3) with kinetic and gravitational energy, we would make the following Hamiltonian. First, we can compute several derived quantities from the variables of the system.

$$
\begin{array}{ll}
I=m l^{2} & \text { (moment of inertia) } \\
\omega=\frac{L}{I} & \text { (rotational velocity) } \\
x=l\left[\begin{array}{c}
\cos \theta \\
\sin \theta
\end{array}\right] & \text { (position of the mass) } \\
v=l \omega\left[\begin{array}{c}
-\sin \theta \\
\cos \theta
\end{array}\right] & \text { (velocity of the mass) } \\
h=x_{2}=l \sin \theta & \text { (height of the mass) }
\end{array}
$$

The Hamiltonian is then the sum of kinetic and gravitational energy, written as

$$
H(\theta, L)=\frac{1}{2} m\|v\|^{2}+m g h
$$
where $g$ is gravitational acceleration. Plugging this $H$ into Eq. (1) gives

$$
\begin{aligned}
& \frac{\mathrm{d} \theta}{\mathrm{d} t}=\frac{L}{I} \\
& \frac{\mathrm{d} L}{\mathrm{~d} t}=-m g l \cos (\theta)
\end{aligned}
$$

Definition 3. For any manifold $X \in$ Mfd, a reaction on $X$ is a map $J: T^{*} X \rightarrow T X$ over $X$. The set of reactions on $X$ is denoted $\boldsymbol{\operatorname { R e a c t }}(X)$. Given a diffeomorphism $f: X \stackrel{\cong}{\cong} Y$, we denote by $\boldsymbol{\operatorname { R e a c t }}(f): \boldsymbol{\operatorname { R e a c t }}(X) \rightarrow$ React $(Y)$ the map sending $J$ to the composite $T^{*} Y \xrightarrow{T^{*} f} T^{*} X \xrightarrow{J} T X \xrightarrow{T f} T Y$.

Remark 4. Reactions are also functorial on étale maps, i.e local diffeomorphisms.

\subsection*{2.2 Gradient descent}

Gradient descent (or gradient ascent) is a very similar story. We start with a state space $X$ along with a Riemmanian metric $g \in \Gamma\left(T^{*} X \otimes T^{*} X\right)$ and a function $S: X \rightarrow \mathbb{R}$. We apply the exact same procedure to $g$ that we did to $\omega$ in order to get a section $M \in \boldsymbol{\operatorname { R e a c t }}(X)$, and then we get the equation

$$
v(x)=M(x) \mathrm{d} S(x)
$$

Example 5. Let $X=\mathbb{R}^{2}$ with the Euclidean metric. Then gradient ascent for a function $S: X \rightarrow \mathbb{R}$ looks like

$$
\frac{\mathrm{d} x_{1}}{\mathrm{~d} t}=\frac{\partial S}{\partial x_{1}}, \quad \frac{\mathrm{d} x_{2}}{\mathrm{~d} t}=\frac{\partial S}{\partial x_{2}}
$$

It is more traditional to write this as $\frac{\mathrm{d} x}{\mathrm{~d} t}=\nabla S(x)^{T}$. It may seem like this doesn't use any fancy Riemannian structure, but in fact transposing a row vector into a column vector is made possible using the isomorphism $\left(\mathbb{R}^{n}\right)^{*} \cong \mathbb{R}^{n}$, the same isomorphism on which the natural inner product for $\mathbb{R}^{n}$ is built.

From Hamiltonian system and gradient descent systems we can provide the following common generalization:

Definition 6. An energy-driven system consists of a state space $X \in \mathbf{M f d}$, a reaction $R \in \boldsymbol{\operatorname { R e a c t }}(X)$, and an energy functional $E: X \rightarrow \mathbb{R}$.

The reaction embodies the "laws of physics", turning energies (given by $E$ ) into forces.

\section*{3 Open Energy-driven Systems}

Most, if not all, systems are in practice open, meaning they are amenable to composition with other systems.

Example 7. Take, for instance, the pendulum system from Example 2 . In there we considered the pivot to be a fixed point, but in practice both pivot and both are physical locations at which other systems can be attached. This means one can consider the pendulum as parametrized by $A=T \mathbb{R}^{2}$, the phase space of the pivot, and to influence the location and velocity of the bob by exposing such quantities in $B=T \mathbb{R}^{2}$. Again, $X=T^{*} S^{1}$, but now, rather than $E: X \rightarrow \mathbb{R}$, we have $E: A \times X \rightarrow \mathbb{R}$ defined by

$$
E\left(\left(x_{0}, v_{0}\right),(\theta, L)\right)=\frac{1}{2 m}\left\|v_{0}+v\right\|^{2}+m g\left(h_{0}+h\right)
$$

This $E$ represents the potential plus kinetic energy of a pendulum whose pivot is at position $x_{0}$ and moving at velocity $v_{0}$.

We then define $w: T \mathbb{R}^{2} \times T^{*} S^{1} \rightarrow T \mathbb{R}^{2}$ by

$$
w\left(\left(x_{0}, v_{0}\right),(\theta, L)\right)=\left(x_{0}+x, v_{0}+v\right)
$$

This gives the position and velocity of the bob.

The "open pendulum" we just described is but an example of a general definition:

Definition 8. Given $A, B \in \mathbf{M f d}$, an open energy-driven system with parameters $A$ and outputs $B$ consists of a manifold $X$, a reaction $R \in \Gamma\left[T^{*} X, T X\right]$, a function $E: A \times X \rightarrow \mathbb{R}$, and a function $w: A \times X \rightarrow B$. We call $A$ the parameters, $X$ the state, and $B$ the output.

The fact that $A=B$ in Example 7 is tantalizing, because it makes the pendulum something like a "parametric endomorphism" of $T \mathbb{R}^{2}$. Could we somehow "compose the pendulum with itself" to make a double pendulum? Also, how can we describe the differential equation attached to an open energy-driven system; i.e. what is the semantics of an open energy-driven system? Answering these questions is the subject of the remainder of this paper.

\subsection*{3.1 Composing Open Energy-driven Systems}

The purpose of this section is to develop a symmetric monoidal category where the morphisms are open energy-driven systems.

We begin with the following straightforward proposition.

Proposition 9. The functor React : Mfd ${ }^{\text {iso }} \rightarrow$ Set from Definition 3 is lax symmetric monoidal, with unitor $1 \rightarrow \boldsymbol{\operatorname { R e a c t }}(1)$ given by the unique element of $\boldsymbol{\operatorname { R e a c t }}(1)$ (the zero map $\mathbb{R}^{0} \rightarrow \mathbb{R}^{0}$ ) and compositor

$$
\oplus_{X_{1}, X_{2}}: \operatorname{React}\left(X_{1}\right) \times \operatorname{React}\left(X_{2}\right) \rightarrow \boldsymbol{\operatorname { R e a c t }}\left(X_{1} \times X_{2}\right)
$$

defined by sending $R_{1} \in \boldsymbol{\operatorname { R e a c t }}\left(X_{1}\right), R_{2} \in \boldsymbol{\operatorname { R e a c t }}\left(X_{2}\right)$ to

$$
T_{\left(x_{1}, x_{2}\right)}^{*}\left(X_{1} \times X_{2}\right) \cong T_{x_{1}}^{*} X_{1} \times T_{x_{2}}^{*} X_{2} \xrightarrow{R_{1}\left(x_{1}\right) \times R_{2}\left(x_{2}\right)} T_{x_{1}} X_{1} \times T_{x_{1}} X_{2} \cong T_{\left(x_{1}, x_{2}\right)}\left(X_{1} \times X_{2}\right) .
$$

Definition 10. Let $\int$ React $\xrightarrow{\pi_{\text {React }}}$ Mfd ${ }^{\text {iso }}$ be the monoidal Grothendieck construction of React (see [MV20]). An object of $\int$ React is a pair $(X, R)$ consisting of a space and a reaction on it, a morphism is a diffeomorphism which preserves the reactions, and the monoidal product $\left(X_{1}, R_{1}\right) \otimes\left(X_{2}, R_{2}\right)$ is given by $\left(X_{1} \times X_{2}, R_{1} \oplus R_{2}\right)$ as above

Example 11. The category of symplectic manifolds and symplectomorphisms embeds faithfully into $\int$ React by sending a symplectic manifold $(X, \omega)$ to $\left(X, J_{\omega}\right)$, where $J_{\omega}$ is the reaction associated to $\omega$, as constructed in Section 2.1] A symplectomorphism is an diffeomorphism that preserves the symplectic structure, and it is not to hard to show that preserving the symplectic structure implies preserving the reaction structure.

Now, as the composite $\int$ React $\xrightarrow{\pi_{\text {React }}}$ Mfd ${ }^{\text {iso }} \xrightarrow{U}$ Mfd is strong monoidal, we have a monoidal action of $\int$ React on Mfd, simply given by $(X, R) \otimes_{U} Y:=X \times Y$. The technique of decorating an action with data coming from a monoidal Grothendieck construction was introduced by [CGHR22].

We can then construct a category OpenReact by applying the Para construction [FST19, CGHR22] to $\otimes_{U}$, and in fact we use this opportunity to recall how the latter is performed.

Definition 12. Let OpenReact be the symmetric monoidal category of open reaction systems defined as the local skeleton 1 of $\operatorname{Para}\left(\otimes_{U}\right)$.

Concretely, an object in OpenReact is a manifold, a morphism $A \rightarrow B$ is an open reaction system and is given by a pair $(X, R) \in \int$ React together with a smooth map $w: X \times A \rightarrow B$. Morphisms $(X, R, w)$ and $\left(X^{\prime}, R^{\prime}, w^{\prime}\right)$ are considered equivalent if there is an isomorphism $i: X \rightarrow X^{\prime}$ with $\boldsymbol{\operatorname { R e a c t }}(i)(R)=R^{\prime}$ and $w=(i \times A) \% w^{\prime}$. The monoidal structure is the same as Mfd.

We reserve to spell out composition later, since this is almost, but not quite, equivalent to our definition of open energy-driven system from before. In fact, compared to energy-driven systems, reaction systems lack the data of an energy functional. We add this by considering such a functional as an effect. In fact $(\mathbb{R}, 0,+)$ is a monoid in OpenReact, because it is a monoid in Mfd and Mfd embeds into OpenReact, and thus $(-) \times \mathbb{R}$ is a monad on OpenReact.

Definition 13. Let OpenErg be the symmetric monoidal category of open energy-driven systems, defined as the Kleisli category of $(-) \times \mathbb{R}$ on OpenReact.

A morphism in OpenErg from $A$ to $B$ is then a states space $X$ with a reaction $R \in \boldsymbol{\operatorname { R e a c t }}(X)$ and a smooth function $\langle w, E\rangle: A \times X \rightarrow B \times \mathbb{R}$, which is precisely an open energy-driven system as in Definition 8 ,

Remark 14. Notice the parameters of $w$ as a parametric morphism correspond to the states of the energy-driven system, while the parameters of the latter are the domain of the former.

The composition of $(X, R,\langle w, E\rangle: A \times X \rightarrow B)$ and $\left(X^{\prime}, R^{\prime},\left\langle w^{\prime}, E^{\prime}\right\rangle: B \times X^{\prime} \rightarrow C\right)$ is the energy-driven system:

$$
\left(X \times X^{\prime}, R \oplus R^{\prime},\left\langle w \gtrdot w^{\prime}, E+w^{*} E^{\prime}\right\rangle: A \times\left(X \times X^{\prime}\right) \rightarrow C\right)
$$

where $w^{*} E^{\prime}: A \times\left(X \times X^{\prime}\right) \rightarrow \mathbb{R}$ is given by $\left(a, x, x^{\prime}\right) \mapsto E^{\prime}\left(w(a, x), x^{\prime}\right)$ and we abuse notation by writing $E$ for $\pi_{A, X} 9 E$.

Remark 15. There are more natural higher-category structures that we could use instead of just symmetric monoidal categories. For instance, the Para construction naturally produces a double category. In fact the generalized Para construction of [Mye23b] CM23] can even define OpenErg in one fell swoop by having the component $E: A \times X \rightarrow \mathbb{R}$ be part of the decoration on the states.

\section*{4 The Semantics of Open Energy-driven Systems}

In order to develop semantics for open energy-driven systems, we must have some notion of an open ODE. It is the job of the current section to construct this.

\subsection*{4.1 Open Ordinary Differential Equations}

Definition 16. A smooth function $p: \bar{X} \rightarrow X$ is a submersion if all $(T p)_{\bar{x}}: T_{e} \bar{X} \rightarrow T_{p(\bar{x})} X$ are surjective.

Proposition 17. If $p: \bar{X} \rightarrow X$ is a submersion, then all pullbacks along p exist, and are computed as in the category of topological spaces.

Proof. Standard, can be found in [KMS93, Corollary I.2.19].
\footnotetext{
${ }^{1}$ Taking the local skeleton of a bicategory means we replace each hom-category by its skeleton, thus locally quotienting by isomorphism. Notice this yields a well-defined strict 1-category since coherence isomorphisms are turned into equalities.
}

Definition 18. Let Subm: Mfd $^{\mathrm{op}} \rightarrow$ Cat be the functor which sends a space $X$ to the category of submersions $\bar{X} \rightarrow X$ over it, and a smooth function $f: X \rightarrow Y$ to its action by pullback $f^{*}: \operatorname{Subm}(Y) \rightarrow$ $\operatorname{Subm}(X)$.

Definition 19. Let MfdLens be the symmetric monoidal category of Subm-lenses ([Spi19]), meaning its objects are given by submersions $p: \bar{X} \rightarrow X$ and denoted by $\binom{\bar{X}}{X}$ and its morphisms, denoted as below left, are given by pairs of dashed arrows as below right:

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-08.jpg?height=210&width=755&top_left_y=573&top_left_x=682)

The symmetric monoidal product of this category is given by fibrewise product of bundles.

The reader might notice that the form of these Subm-lenses is exactly that of the pullback map on covectors induced between the cotangent bundles by any smooth map, i.e. if $f: X \rightarrow Y$ is a smooth map there is a corresponding lens

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-08.jpg?height=198&width=466&top_left_y=1018&top_left_x=821)

In fact the assignment $f \mapsto\binom{T^{*} f}{f}$ defines a functor $T^{*}: \mathbf{M f d} \rightarrow$ MfdLens, which will be central later.

We want to interpret an open energy-driven system on $A, B$ with state space $X$ as a parametric lens:

$$
\binom{T^{*} A}{A} \otimes\binom{T^{*} X}{X} \leftrightarrows\binom{T^{*} B}{B}
$$

where the parameter space $X$ is decorated by the data of a reaction, seen as an open $\operatorname{ODE}\binom{{ }^{T X}}{X} \leftrightarrows\binom{T^{*} X}{X}$. We do this with a similar Para construction as before.

Definition 20. There is a symmetric monoidal functor ODE: MfdLens $\rightarrow$ Set

$$
\binom{\bar{Y}}{Y} \mapsto \mathbf{O D E}\binom{\bar{Y}}{Y}:=\left\{X \in \mathbf{M f d},\binom{u^{\sharp}}{u}:\binom{T X}{X} \leftrightarrows\binom{\bar{Y}}{Y}\right\}
$$

and with reindexing along a lens $\binom{\bar{Y}}{Y} \leftrightarrows\binom{\bar{Y}^{\prime}}{Y^{\prime}}$ given by composition. The symmetric monoidal structure is inherited in the obvious way from that of MfdLens, and leans crucially on the fact that $T$ is a strong monoidal functor.

Let $\int$ ODE be the monoidal Grothendieck construction. This is, like $\int$ React, a symmetric monoidal category with a symmetric monoidal projection functor $\int \mathrm{ODE} \rightarrow$ MfdLens. It induces an action of the former on the latter, which we denote $\otimes$ oDE.

Similarly, the tangent bundle functor extends to a symmetric monoidal functor $T:$ Mfd $^{\text {iso }} \rightarrow$ MfdLens sending $X \mapsto\binom{T X}{X}$. This defines an action of $\mathbf{M f f}^{\text {iso }}$ on MfdLens, which we denote $\otimes_{T}$.

Definition 21. We call OpenODE the local skeleton of $\operatorname{Para}\left(\otimes_{\text {ODE }}\right)$.

Thus a map $\binom{\bar{A}}{A} \rightarrow\binom{\bar{B}}{B}$ in OpenODE is a choice of parameter interface $\binom{\bar{X}}{X}$ and of an open ODE over it, say $\binom{u^{\sharp}}{u}:\binom{T X}{X} \leftrightarrows\binom{\bar{X}}{X}$, and then a choice of smooth lens $\binom{\bar{A}}{A} \otimes\binom{\bar{X}}{X} \leftrightarrows\binom{\bar{B}}{B}$. Thus the open ODE is just a decoration of the parameter.

\subsection*{4.2 An "organized" view}

In the symmetric monoidal category OpenODE, systems (the ODEs) and their wiring (the parametric lens they are grafted on) are kept neatly separated. This is because, in general, the systems might be very different from their wiring, but in this case they aren't: both open ODEs and their wiring are differential lenses, so one can collapse the data of the ODE directly in the wiring, seeing it as all part of a unique process.

This brings us to define $\mathbb{C} O \mathbf{r g}$, which is smooth space, continuous time variant of $\mathbb{O} \mathbf{r g}$, introduced in [Spi22] We give a sleek definition.

Definition 22. We define COrg to be the local skeleton of Para $\left(\otimes_{T}\right)$, with the latter being the action induced by the symmetric monoidal functor $T:$ Mfd $\rightarrow$ MfdLens.

The categories OpenODE and COrg have the same objects, namely submersions $\binom{\bar{A}}{A}$, but a morphism from $\binom{\bar{A}}{A}$ to $\binom{\bar{B}}{B}$ in COrg consists of a manifold $X$ (up to diffeomorphism) and a lens $\binom{\bar{A}}{A} \otimes\binom{T X X}{X} \leftrightarrows\binom{\bar{B}}{B}$

Proposition 23. There is an identity-on-objects, symmetric monoidal functor

$$
\text { collapse }: \text { OpenODE } \longrightarrow \mathbb{C} \text { Org }
$$

given by

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-09.jpg?height=256&width=1107&top_left_y=1249&top_left_x=504)

Proof. The fact this is functorial and symmetric monoidal boils down to the interchange law of the monoidal structure of MfdLens, which allows to map composition in OpenODE (which puts the ODEs in the parameter side by side) to composition in $\mathbb{C O r g}$ (which composes sequentially the morphisms).

In fact, this definition applies already to discrete systems, i.e. to (the horizontal 1-category of) $\mathbb{O} \mathbf{r g}$. Starting with Poly, we define a functor Coalg: Poly $\rightarrow$ Set which sends a polynomial to its (large) set of coalgebras. Applying the Para construction to the forgetful functor $\int \mathbf{C o a l g} \rightarrow$ Poly, we get something similar to OpenODE, where a morphism from $p$ to $q$ is a polynomial $r$, a coalgebra $\delta: S \rightarrow r(S)$, and a poly map $\binom{f^{\sharp}}{f}: p \otimes r \rightarrow q$. The coalgebra is in fact equivalent to a map $\hat{\delta}: S y^{S} \rightarrow r$, and thus we can collapse the pair $\left(\delta,\binom{f^{\sharp}}{f}\right.$ ) to a single map $p \otimes S y^{S} \rightarrow q$. In this way we defined a symmetric monoidal functor Para $\left(\otimes_{\text {Coalg }}\right) \rightarrow \mathbb{O} \mathbf{r g}$.

Generally speaking, this trick works whenever the indexed set of systems Sys : $\mathbf{C} \rightarrow$ Set is 'free' in a specific sense: its elements are the objects of the slice $T / \mathbf{C}$, there $\mathrm{T}$ is a functor $T:$ States $\rightarrow \mathbf{C}$ which picks out "state spaces" $\left.\right|^{2}$ In that case we can always build a collapse functor Para $\left(\otimes_{\text {Sys }}\right) \rightarrow \mathbf{P a r a}\left(\otimes_{T}\right)$ by reproducing the construction of Proposition 23. Systems which are given by slicing under a functor play a central role in [Mye23a], where Myers shows most theories of systems can be obtained in this way.
\footnotetext{
${ }^{2}$ Being a "state space" is an attitude, not a formal mathematical concepts: any functor into $\mathbf{C}$ suffices.
}

\subsection*{4.3 The Cotangent Functor}

The aim of this section is to show how the cotangent functor $T^{*}: \mathbf{M f d} \rightarrow$ MfdLens induces a functor OpenErg $\longrightarrow$ OpenODE:

$$
\begin{aligned}
& \binom{T X}{X} \in \mathbf{O D E}\binom{T^{*} X}{X}
\end{aligned}
$$

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-10.jpg?height=163&width=1260&top_left_y=566&top_left_x=427)

The functor could be obtained in one single step using the technology of the generalized Para construction we hinted at in Remark 15 with which we can see both OpenErg and OpenODE as Para constructions and thus induce the desired functor by exhibiting one between the underlying fibred actions (see [CM23]). Since we don't have the space to introduce this machinery, we just give a direct construction.

This would make the analogy with [Cap23] total since that's how the functor from game descriptions to parametric lenses is obtained. Notably, in this case $T^{*}$ is strong monoidal thus making the semantics of open energy-driven systems truly compositional.

Theorem 24. The assignment defined in (7) is a well-defined symmetric monoidal functor

\section*{$T^{*}:$ OpenErg $\longrightarrow$ OpenODE}

Proof. It's easy to see it sends identities to identities. Given composable open energy-driven systems $(X, R,\langle w, E\rangle: A \times X \rightarrow B)$ and $\left(X^{\prime}, R^{\prime},\left\langle w^{\prime}, E^{\prime}\right\rangle: B \times X^{\prime} \rightarrow C\right)$, their image yields the composable open ODEs

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-10.jpg?height=262&width=1106&top_left_y=1517&top_left_x=507)

which reduces to

$$
\begin{gathered}
\binom{T\left(X \times X^{\prime}\right)}{X \times X^{\prime}} \\
\| \uparrow R \oplus R^{\prime} \\
\binom{T^{*} A}{A} \otimes\binom{T^{*}\left(X \times X^{\prime}\right)}{X \times X^{\prime}} \stackrel{T^{*} w+\mathrm{d} E}{\leftrightarrows}\binom{T^{*} B}{B} \otimes\binom{T^{*} X^{\prime}}{X^{\prime}} \stackrel{T^{*} w^{\prime}+\mathrm{d} E^{\prime}}{\leftrightarrows}\binom{T^{*} C}{C}
\end{gathered}
$$

Given $a \in A, x \in X, x^{\prime} \in X^{\prime}$, the composite backward map sends a covector $\alpha \in T^{*} C$ (we omit indexing of bundles for brevity) to

$$
T^{*} w\left(T^{*} w^{\prime}(\boldsymbol{\alpha})+\mathrm{d} E^{\prime}\left(w(a, x), x^{\prime}\right)\right)+\mathrm{d} E(a, x)=T^{*}\left(w 9 w^{\prime}\right)(\alpha)+\mathrm{d}\left(w^{*} E^{\prime}+E\right)\left(a, x, x^{\prime}\right)
$$

The latter expression equals the image of the composite energy-driven system $\left(X \times X^{\prime}, R \oplus R^{\prime},\left\langle w\right.\right.$ و $w^{\prime}, E+$ $\left.\left.w^{*} E^{\prime}\right\rangle: A \times\left(X \times X^{\prime}\right) \rightarrow C\right):$

$$
\begin{gathered}
\binom{T\left(X \times X^{\prime}\right)}{X \times X^{\prime}} \\
\| \uparrow R \oplus R^{\prime} \\
\binom{T^{*} A}{A} \otimes\binom{T^{*}\left(X \times X^{\prime}\right)}{\left(X \times X^{\prime}\right)} \stackrel{T^{*}\left(w \circ w^{\prime}\right)+\mathrm{d}\left(E+w^{*} E^{\prime}\right)}{\stackrel{w_{9}^{\circ} w^{\prime}}{\leftrightarrows}}\binom{T^{*} C}{C}
\end{gathered}
$$

Preservation of symmetric monoidal structure is trivial, as it amounts to no more than the analogue structure on $T^{*}$.

We can further collapse the description of the dynamics of the system by folding the ODE into the map itself, thus landing in $\mathbb{C}$ Org:

$$
\text { OpenErg } \xrightarrow{\mathbf{T}^{*}} \text { OpenODE } \xrightarrow{\text { collapse }} \text { COrg. }
$$

\section*{5 Examples}

We motivated the last three sections by saying that we were going to compose the pendulum with itself to get an $n$-fold pendulum. We do this now.

Example 25. For intuition, observe the following diagram of the double pendulum. We will work out carefully the composition of two pendulums to create a double pendulum, and leave the iterated composition to the reader.

![](https://cdn.mathpix.com/cropped/2024_05_21_54ebce5489a3189d78dcg-11.jpg?height=393&width=206&top_left_y=1473&top_left_x=881)

Recall that the single pendulum in OpenErg as defined in Example 7 is an endomorphism $T \mathbb{R}^{2} \rightarrow T \mathbb{R}^{2}$, whose state space is $T^{*} S^{1}$ and whose reaction structure is derived from the canonical symplectic structure and written in coordinate form as $J(x)=\left[\begin{array}{cc}0 & 1 \\ -1 & 0\end{array}\right]$.

Composing this morphism with itself involves several steps, where we unwind all of the constructions that we've done so far. First of all, we have to take the monoidal product of $\left(T^{*} S^{1}, J\right)$ with itself in $\int$ React. This uses the lax monoidal structure of React to produce a reaction $J^{(2)}=J \oplus J$ on $T^{*} S^{1} \times T^{*} S^{1}$. In coordinates, this is the block-diagonal matrix

$$
J^{(2)}(x)=\left[\begin{array}{cc}
J(x) & 0 \\
0 & J(x)
\end{array}\right]
$$

Transforming this along the isomorphism $T^{*} S^{1} \times T^{*} S^{1} \cong T^{*}\left(S^{1} \times S^{1}\right)$, this becomes the standard

$$
J^{(2)}(x)=\left[\begin{array}{cc}
0 & I_{2} \\
-I_{2} & 0
\end{array}\right]
$$

This gives a new parameter space; we now compose the smooth maps $w$ and $E$ with themselves to get $w^{(2)}: T \mathbb{R}^{2} \times\left(T^{*} S^{1} \times T^{*} S^{1}\right) \rightarrow T \mathbb{R}^{2}$ defined by

$$
T \mathbb{R}^{2} \times T^{*} S^{1} \times T^{*} S \xrightarrow{w \times 1_{T^{*} S^{1}}} T \mathbb{R}^{2} \times T^{*} S^{1} \xrightarrow{w} T \mathbb{R}^{2}
$$

and $E^{(2)}: T \mathbb{R}^{2} \times\left(T^{*} S^{1} \times T^{*} S^{1}\right) \rightarrow \mathbb{R}$ defined by

$$
T \mathbb{R}^{2} \times T^{*} S^{1} \times T^{*} S \xrightarrow{\left\langle E, w \times 1_{\left.T^{*} S S^{1}\right\rangle}\right.} \mathbb{R} \times T \mathbb{R}^{2} \times T^{*} S^{1} \xrightarrow{1_{\mathbb{R}} \times E} \mathbb{R} \times \mathbb{R} \xrightarrow{+} \mathbb{R}
$$

In coordinates, this looks like the following. Assume that $x_{0}, v_{0}$ are the position and velocity of the first pivot, and $\theta_{1}, L_{1}, \theta_{2}, L_{2}$ are the natural coordinates for $T^{*} S^{1} \times T^{*} S^{1}$.

$$
\begin{aligned}
x_{1} & =x_{0}+l\left(\cos \theta_{1}, \sin \theta_{1}\right) \\
\omega_{1} & =\frac{L_{1}}{I} \\
v_{1} & ==x_{0}+l \omega_{1}\left(-\sin \theta_{1}, \cos \theta_{1}\right) \\
x_{2} & =x_{1}+l\left(\cos \theta_{2}, \sin \theta_{2}\right) \\
\omega_{2} & =\frac{L_{2}}{I} \\
v_{2} & ==x_{1}+l \omega_{2}\left(-\sin \theta_{2}, \cos \theta_{2}\right) \\
w^{(2)} & =\left(x_{2}, v_{2}\right) \\
E^{(2)} & =\frac{1}{2} m\left|v_{1}\right|^{2}+\frac{1}{2} m\left|v_{2}\right|^{2}+m g h_{1}+m g h_{2}
\end{aligned}
$$

We leave it to the reader to apply the functor OpenErg $\rightarrow \mathbb{C O r g}$ in order to get an open dynamical system out of this.

\section*{6 Epilogue}

In this work, we have shown have the structure of an open energy-driven system, involving a reaction and an energy functional, elegantly subsumes both Hamiltonian and gradient-based systems. Out of these, we have built a symmetric monoidal category OpenErg which maps to OpenODE, a symmetric monoidal category of open ODEs, which itself maps to COrg, whose morphisms are lenses 'evolving smoothly' according to a given state space.

While this may seem like a lot of work/abstraction for little gain compared to "just doing physics" in the way a sophomore in a classical mechanics would, the advantage of working out this theory is to produce a "plug and play" physics system, where a library of components can be intuitively composed and all of the algebra is done by the computer.

\section*{References}

[Arn13] Vladimir Igorevich Arnol'd (2013): Mathematical methods of classical mechanics. 60, Springer Science \& Business Media.

[BWY21] John C. Baez, David Weisbart \& Adam M. Yassine (2021): Open systems in classical mechanics. Journal of Mathematical Physics 62(4), doi:10.1063/5.0029885.

[Cap23] Matteo Capucci (2023): Diegetic representation offeedback in open games. Electronic Proceedings in Theoretical Computer Science 380, pp. 145-158, doi 10.4204/EPTCS.380.9.

[CFM21] Marius Crainic, Rui Loja Fernandes \& Ioan Mărcuţ (2021): Lectures on Poisson geometry. 217, American Mathematical Soc. Available at https://books.google.com/books?hl=en\&lr=\&id= w3VJEAAAQBAJ\&oi=fnd\&pg=PP1\&dq=Lectures+on+Poisson+Geometry\&ots=UPC-6ZFLz-\& sig=u8Y1C0di7N0M4iCW6yQ14qxbgFs.

$\left[\mathrm{CGG}^{+} 22\right]$ Geoffrey S. H. Cruttwell, Bruno Gavranović, Neil Ghani, Paul Wilson \& Fabio Zanasi (2022): Categorical Foundations of Gradient-Based Learning. In Ilya Sergey, editor: Programming Languages and Systems, Springer International Publishing, Cham, pp. 1-28, doi 10.1007/978-3-030-99336-8_1

[CGHR22] Matteo Capucci, Bruno Gavranović, Jules Hedges \& Eigil Fjeldgren Rischel (2022): Towards Foundations of Categorical Cybernetics. Electronic Proceedings in Theoretical Computer Science 372, pp. 235-248, doi $10.4204 /$ eptcs.372.17.

[CM23] Matteo Capucci \& David Jaz Myers (2023): Constructing Triple Categories of Cybernetic Processes, doi: $10.5281 /$ zenodo. 8215544

[FST19] Brendan Fong, David Spivak \& Remy Tuyeras (2019): Backprop as Functor: A compositional perspective on supervised learning. In: 2019 34th Annual ACM/IEEE Symposium on Logic in Computer Science (LICS), IEEE, doi.10.1109/lics.2019.8785665. Available at http://dx.doi.org/ 10.1109/LICS.2019.8785665

[KMS93] Ivan Kolar, Peter W Michor \& Jan Slovak (1993): Natural operations in differential geometry, 1993 edition. Springer, Berlin, Germany.

[Law80] F William Lawvere (1980): Toward the description in a smooth topos of the dynamically possible motions and deformations of a continuous body. Cahiers de topologie et géométrie différentielle 21(4), pp. $377-392$.

[LBPF22] Sophie Libkind, Andrew Baas, Evan Patterson \& James Fairbanks (2022): Operadic Modeling of Dynamical Systems: Mathematics and Computation. Electronic Proceedings in Theoretical Computer Science 372, pp. 192-206, doi $10.4204 /$ eptcs. 372.14

[LLL24] Markus Lohmayer, Owen Lynch \& Sigrid Leyendecker (2024): Exergetic Port-Hamiltonian Systems Modeling Language, doi 10.48550/ARXIV.2402.17640 Available at https://arxiv.org/abs/ 2402.17640

[Lyn22] Owen Lynch (2022): Relational Composition of Physical Systems: A Categorical Approach. M.sc. thesis. Available at https://studenttheses.uu.nl/handle/20.500.12932/41725

$\left[\mathrm{MGA}^{+}\right.$21] Yingbo Ma, Shashi Gowda, Ranjan Anantharaman, Chris Laughman, Viral Shah \& Chris Rackauckas (2021): ModelingToolkit: A Composable Graph Transformation System For Equation-Based Modeling. $\operatorname{arXiv} 2103.05244$

[MV20] Joe Moeller \& Christina Vasilakopoulou (2020): Monoidal Grothendieck Construction. Theory and Applications of Categories 35(31), pp. 1159-1207.

[Mye23a] David Jaz Myers (2023): Categorical Systems Theory. Available at http://davidjaz.com/Papers/ DynamicalBook.pdf.

[Mye23b] David Jaz Myers (2023): The Para construction as a Wreath Product. Available at https:// davidjaz.com/Talks/CT2023_Para_as_Wreath_Product.pdf

[Sou06] Jean-Marie Souriau (2006): Groupes différentiels. In: Differential Geometrical Methods in Mathematical Physics: Proceedings of the Conferences Held at Aix-en-Provence, September 3-7, 1979 and Salamanca, September 10-14, 1979, Springer, pp. 91-128.

[Spi19] David I. Spivak (2019): Generalized Lens Categories via Functors C ${ }^{\text {op }} \rightarrow$ Cat, doi: $10.48550 /$ ARXIV.1908.02202.

[Spi22] David I. Spivak (2022): Learners' Languages. Electronic Proceedings in Theoretical Computer Science 372, pp. 14-28, doi 10.4204 /eptcs.372.2.

[SS23] Brandon T. Shapiro \& David I. Spivak (2023): Dynamic Operads, Dynamic Categories: From Deep Learning to Prediction Markets. Electronic Proceedings in Theoretical Computer Science 380, pp. 183-202, doi 10.4204/eptcs.380.11.